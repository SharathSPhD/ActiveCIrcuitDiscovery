/home/ubuntu/project_venv/lib/python3.10/site-packages/torchvision/io/image.py:13: UserWarning: Failed to load image Python extension: '/home/ubuntu/project_venv/lib/python3.10/site-packages/torchvision/image.so: undefined symbol: _ZN3c1017RegisterOperatorsD1Ev'If you don't plan on using image functionality from `torchvision.io`, you can ignore this warning. Otherwise, there might be something wrong with your environment. Did you have `libjpeg` or `libpng` installed before building `torchvision` from source?
  warn(
2025-07-08 14:19:47,550 - src.visualization.visualizer - INFO - Enhanced CircuitVisualizer initialized: visualizations
2025-07-08 14:19:47,550 - __main__ - INFO - Initialized ComprehensiveExperimentRunner: comprehensive_exp_20250708_141947
2025-07-08 14:19:47,550 - __main__ - INFO - Model: google/gemma-2-2b, Transcoders: gemma
2025-07-08 14:19:47,550 - __main__ - INFO - Output directory: comprehensive_experiment_results
2025-07-08 14:19:47,550 - __main__ - INFO - üöÄ Starting comprehensive experiment: comprehensive_exp_20250708_141947
2025-07-08 14:19:47,550 - __main__ - INFO - üïê Start time: 2025-07-08 14:19:47.550663
2025-07-08 14:19:47,550 - __main__ - INFO - ============================================================
2025-07-08 14:19:47,550 - __main__ - INFO - PHASE 1: MODEL INITIALIZATION AND VALIDATION
2025-07-08 14:19:47,550 - __main__ - INFO - ============================================================
2025-07-08 14:19:47,550 - __main__ - INFO - üîß Initializing models and components...
2025-07-08 14:19:48,409 - circuit_tracer.utils.hf_utils - INFO - Performing pre-flight metadata check...
2025-07-08 14:19:48,499 - circuit_tracer.utils.hf_utils - INFO - Pre-flight check complete. Starting downloads...
üöÄ Starting Comprehensive Active Circuit Discovery Experiment
============================================================
üîß Initializing RealCircuitTracer with google/gemma-2-2b + gemma
üîß Initializing RealCircuitTracer with google/gemma-2-2b + gemma
üì• Loading google/gemma-2-2b with circuit-tracer and gemma transcoders...
Fetching 26 files:   0%|          | 0/26 [00:00<?, ?it/s]Fetching 26 files:   4%|‚ñç         | 1/26 [00:00<00:02,  8.66it/s]Fetching 26 files:  31%|‚ñà‚ñà‚ñà       | 8/26 [00:00<00:00, 33.74it/s]Fetching 26 files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 26/26 [00:00<00:00, 73.41it/s]
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|‚ñà‚ñà‚ñà‚ñé      | 1/3 [00:00<00:00,  3.13it/s]Loading checkpoint shards:  67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 2/3 [00:00<00:00,  3.29it/s]Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 3/3 [00:00<00:00,  4.67it/s]
2025-07-08 14:20:08,361 - __main__ - INFO - ‚úÖ Model inference test passed: logits shape torch.Size([1, 3, 256000]), activations shape torch.Size([26, 3, 16384])
2025-07-08 14:20:08,361 - src.active_inference.proper_agent - INFO - State space: [64, 4, 3], Observation space: [5, 3]
2025-07-08 14:20:08,371 - src.active_inference.proper_agent - INFO - Generative model created with proper A, B, C, D matrices
2025-07-08 14:20:08,371 - src.active_inference.proper_agent - INFO - Real pymdp Agent initialized with 9 policies
2025-07-08 14:20:08,371 - src.active_inference.proper_agent - INFO - ProperActiveInferenceAgent initialized with 9 policies
2025-07-08 14:20:08,371 - __main__ - INFO - ‚úÖ ProperActiveInferenceAgent initialized with real pymdp
2025-07-08 14:20:08,372 - __main__ - INFO - üéØ All components initialized successfully
2025-07-08 14:20:08,372 - __main__ - INFO - ============================================================
2025-07-08 14:20:08,372 - __main__ - INFO - PHASE 2: GOLDEN GATE BRIDGE SEMANTIC DISCOVERY
2025-07-08 14:20:08,372 - __main__ - INFO - ============================================================
2025-07-08 14:20:08,372 - __main__ - INFO - üåâ Testing Golden Gate Bridge ‚Üí San Francisco semantic discovery...
2025-07-08 14:20:08,372 - __main__ - INFO - Testing prompt 1/5: 'The Golden Gate Bridge is located in'
2025-07-08 14:20:08,466 - __main__ - INFO - ‚úÖ Semantic discovery successful: San
2025-07-08 14:20:08,466 - __main__ - INFO - Testing prompt 2/5: 'San Francisco's most famous landmark is the'
2025-07-08 14:20:08,547 - __main__ - INFO - ‚ùå Semantic discovery failed
2025-07-08 14:20:08,547 - __main__ - INFO - Testing prompt 3/5: 'The iconic red bridge connecting San Francisco to Marin County is the'
2025-07-08 14:20:08,624 - __main__ - INFO - ‚ùå Semantic discovery failed
2025-07-08 14:20:08,624 - __main__ - INFO - Testing prompt 4/5: 'Visitors to the Golden Gate Bridge are in'
2025-07-08 14:20:08,698 - __main__ - INFO - ‚ùå Semantic discovery failed
2025-07-08 14:20:08,698 - __main__ - INFO - Testing prompt 5/5: 'The city famous for the Golden Gate Bridge is'
2025-07-08 14:20:08,771 - __main__ - INFO - ‚ùå Semantic discovery failed
2025-07-08 14:20:08,771 - __main__ - INFO - üåâ Golden Gate results: 1/5 successful
2025-07-08 14:20:08,771 - __main__ - INFO - üåâ Success rate: 20.0%
2025-07-08 14:20:08,771 - __main__ - INFO - üåâ Average confidence: 0.128
2025-07-08 14:20:08,772 - __main__ - INFO - ============================================================
2025-07-08 14:20:08,772 - __main__ - INFO - PHASE 3: COMPREHENSIVE CIRCUIT DISCOVERY
2025-07-08 14:20:08,772 - __main__ - INFO - ============================================================
2025-07-08 14:20:08,772 - __main__ - INFO - üîç Running comprehensive circuit discovery...
2025-07-08 14:20:09,507 - circuit_tracer.utils.hf_utils - INFO - Performing pre-flight metadata check...
2025-07-08 14:20:09,604 - circuit_tracer.utils.hf_utils - INFO - Pre-flight check complete. Starting downloads...
Loaded pretrained model google/gemma-2-2b into HookedTransformer
‚úÖ RealCircuitTracer initialized successfully!
   Model: google/gemma-2-2b
   Transcoders: gemma
   Layers: 26
   Features per layer: 16384
üì• Loading google/gemma-2-2b with circuit-tracer and gemma transcoders...
Fetching 26 files:   0%|          | 0/26 [00:00<?, ?it/s]Fetching 26 files:   4%|‚ñç         | 1/26 [00:00<00:02,  9.81it/s]Fetching 26 files:  58%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä    | 15/26 [00:00<00:00, 80.21it/s]Fetching 26 files:  88%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä | 23/26 [00:00<00:00, 44.27it/s]Fetching 26 files: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 26/26 [00:00<00:00, 52.12it/s]
Loading checkpoint shards:   0%|          | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|‚ñà‚ñà‚ñà‚ñé      | 1/3 [00:00<00:00,  3.70it/s]Loading checkpoint shards:  67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 2/3 [00:00<00:00,  3.59it/s]Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 3/3 [00:00<00:00,  5.14it/s]
2025-07-08 14:20:28,960 - src.active_inference.proper_agent - INFO - State space: [64, 4, 3], Observation space: [5, 3]
2025-07-08 14:20:28,969 - src.active_inference.proper_agent - INFO - Generative model created with proper A, B, C, D matrices
2025-07-08 14:20:28,970 - src.active_inference.proper_agent - INFO - Real pymdp Agent initialized with 9 policies
2025-07-08 14:20:28,970 - src.active_inference.proper_agent - INFO - ProperActiveInferenceAgent initialized with 9 policies
2025-07-08 14:20:28,970 - src.active_inference.proper_agent - INFO - Initializing AI agent from 4949 circuit features
2025-07-08 14:20:29,073 - src.active_inference.proper_agent - INFO - Selected intervention: InterventionType.ABLATION on feature 2
2025-07-08 14:20:29,335 - src.active_inference.proper_agent - INFO - Updating beliefs from intervention on feature 2
2025-07-08 14:20:29,434 - src.active_inference.proper_agent - INFO - AI agent updated beliefs and selected action: [0. 0. 0.]
2025-07-08 14:20:29,434 - __main__ - INFO - üîç Circuit discovery completed:
2025-07-08 14:20:29,434 - __main__ - INFO -    Features discovered: 4949
2025-07-08 14:20:29,434 - __main__ - INFO -    Interventions performed: 1
2025-07-08 14:20:29,434 - __main__ - INFO -    Convergence achieved: True
2025-07-08 14:20:29,434 - __main__ - INFO - ============================================================
2025-07-08 14:20:29,434 - __main__ - INFO - PHASE 4: ACTIVE INFERENCE ANALYSIS
2025-07-08 14:20:29,434 - __main__ - INFO - ============================================================
2025-07-08 14:20:29,435 - __main__ - INFO - üß† Analyzing Active Inference behavior...
2025-07-08 14:20:29,435 - __main__ - ERROR - ‚ùå Experiment failed: matmul: Input operand 0 does not have enough dimensions (has 0, gufunc core with signature (n?,k),(k,m?)->(n?,m?) requires 1)
Traceback (most recent call last):
  File "/home/ubuntu/ActiveCIrcuitDiscovery/run_comprehensive_experiment.py", line 224, in run_comprehensive_experiment
    ai_analysis = await self.run_active_inference_analysis()
  File "/home/ubuntu/ActiveCIrcuitDiscovery/run_comprehensive_experiment.py", line 449, in run_active_inference_analysis
    current_beliefs = self.integration.ai_agent.get_current_beliefs()
  File "/home/ubuntu/ActiveCIrcuitDiscovery/src/active_inference/proper_agent.py", line 518, in get_current_beliefs
    entropies = [entropy(qs) for qs in current_qs]
  File "/home/ubuntu/ActiveCIrcuitDiscovery/src/active_inference/proper_agent.py", line 518, in <listcomp>
    entropies = [entropy(qs) for qs in current_qs]
  File "/home/ubuntu/project_venv/lib/python3.10/site-packages/pymdp/maths.py", line 606, in entropy
    H = - np.diag(np.matmul(A_merged.T, np.log(A_merged + EPS_VAL)))
ValueError: matmul: Input operand 0 does not have enough dimensions (has 0, gufunc core with signature (n?,k),(k,m?)->(n?,m?) requires 1)
2025-07-08 14:20:29,435 - __main__ - ERROR - Experiment failed: matmul: Input operand 0 does not have enough dimensions (has 0, gufunc core with signature (n?,k),(k,m?)->(n?,m?) requires 1)
Traceback (most recent call last):
  File "/home/ubuntu/ActiveCIrcuitDiscovery/run_comprehensive_experiment.py", line 1276, in main
    result = await runner.run_comprehensive_experiment()
  File "/home/ubuntu/ActiveCIrcuitDiscovery/run_comprehensive_experiment.py", line 296, in run_comprehensive_experiment
    raise e
  File "/home/ubuntu/ActiveCIrcuitDiscovery/run_comprehensive_experiment.py", line 224, in run_comprehensive_experiment
    ai_analysis = await self.run_active_inference_analysis()
  File "/home/ubuntu/ActiveCIrcuitDiscovery/run_comprehensive_experiment.py", line 449, in run_active_inference_analysis
    current_beliefs = self.integration.ai_agent.get_current_beliefs()
  File "/home/ubuntu/ActiveCIrcuitDiscovery/src/active_inference/proper_agent.py", line 518, in get_current_beliefs
    entropies = [entropy(qs) for qs in current_qs]
  File "/home/ubuntu/ActiveCIrcuitDiscovery/src/active_inference/proper_agent.py", line 518, in <listcomp>
    entropies = [entropy(qs) for qs in current_qs]
  File "/home/ubuntu/project_venv/lib/python3.10/site-packages/pymdp/maths.py", line 606, in entropy
    H = - np.diag(np.matmul(A_merged.T, np.log(A_merged + EPS_VAL)))
ValueError: matmul: Input operand 0 does not have enough dimensions (has 0, gufunc core with signature (n?,k),(k,m?)->(n?,m?) requires 1)
Loaded pretrained model google/gemma-2-2b into HookedTransformer
‚úÖ RealCircuitTracer initialized successfully!
   Model: google/gemma-2-2b
   Transcoders: gemma
   Layers: 26
   Features per layer: 16384
üîç Discovering transcoder features across 26 layers for: 'The Golden Gate Bridge is located in...'
‚úÖ Discovered 4949 active transcoder features
üéØ Intervening on Layer 0 Feature 2 (ablation)
üìä Baseline: 'San' ‚Üí Modified: 'San'
üìä Effect magnitude: 0.0000
‚úÖ Intervention minimal effect
Traceback (most recent call last):
  File "/home/ubuntu/ActiveCIrcuitDiscovery/run_comprehensive_experiment.py", line 1286, in <module>
    result = asyncio.run(main())
  File "/usr/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "/usr/lib/python3.10/asyncio/base_events.py", line 649, in run_until_complete
    return future.result()
  File "/home/ubuntu/ActiveCIrcuitDiscovery/run_comprehensive_experiment.py", line 1276, in main
    result = await runner.run_comprehensive_experiment()
  File "/home/ubuntu/ActiveCIrcuitDiscovery/run_comprehensive_experiment.py", line 296, in run_comprehensive_experiment
    raise e
  File "/home/ubuntu/ActiveCIrcuitDiscovery/run_comprehensive_experiment.py", line 224, in run_comprehensive_experiment
    ai_analysis = await self.run_active_inference_analysis()
  File "/home/ubuntu/ActiveCIrcuitDiscovery/run_comprehensive_experiment.py", line 449, in run_active_inference_analysis
    current_beliefs = self.integration.ai_agent.get_current_beliefs()
  File "/home/ubuntu/ActiveCIrcuitDiscovery/src/active_inference/proper_agent.py", line 518, in get_current_beliefs
    entropies = [entropy(qs) for qs in current_qs]
  File "/home/ubuntu/ActiveCIrcuitDiscovery/src/active_inference/proper_agent.py", line 518, in <listcomp>
    entropies = [entropy(qs) for qs in current_qs]
  File "/home/ubuntu/project_venv/lib/python3.10/site-packages/pymdp/maths.py", line 606, in entropy
    H = - np.diag(np.matmul(A_merged.T, np.log(A_merged + EPS_VAL)))
ValueError: matmul: Input operand 0 does not have enough dimensions (has 0, gufunc core with signature (n?,k),(k,m?)->(n?,m?) requires 1)
